<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traefik UI</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Traefik Configuration Manager</h1>
            <div class="header-controls">
                <button id="theme-toggle" class="btn btn-secondary" title="Toggle theme">üåì</button>
                <button id="refresh-btn" class="btn btn-secondary">Refresh Config</button>
            </div>
        </header>

        <nav class="main-nav">
            <div class="nav-group">
                <span class="nav-group-label">üìä Monitoring</span>
                <button class="tab-btn active" data-tab="overview">Overview</button>
                <button class="tab-btn" data-tab="domain-overview">Domain Overview</button>
                <button class="tab-btn" data-tab="service-discovery">Service Discovery</button>
                <button class="tab-btn" data-tab="network-management">Network Management</button>
            </div>
            
            <div class="nav-group">
                <span class="nav-group-label">‚öôÔ∏è Configuration</span>
                <button class="tab-btn" data-tab="add-route">Add Route</button>
                <button class="tab-btn" data-tab="middleware">Middleware</button>
                <button class="tab-btn" data-tab="dns-providers">DNS Providers</button>
                <button class="tab-btn" data-tab="observability">Observability</button>
            </div>
            
            <div class="nav-group">
                <span class="nav-group-label">üõ†Ô∏è Tools</span>
                <button class="tab-btn" data-tab="label-generator">Label Generator</button>
                <button class="tab-btn" data-tab="templates">Templates</button>
                <button class="tab-btn" data-tab="system-config">System Config</button>
            </div>
        </nav>

        <div id="overview" class="tab-content active">
            <div class="section">
                <h2>Current Routes</h2>
                <div id="routes-list" class="routes-container">
                    <p>Loading...</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Services</h2>
                <div id="services-list" class="services-container">
                    <p>Loading...</p>
                </div>
            </div>
        </div>

        <div id="domain-overview" class="tab-content">
            <div class="section">
                <h2>Domain Overview</h2>
                <p>Comprehensive view of all domains with their routing paths, health status, and observability data.</p>
                
                <div class="domain-overview-controls">
                    <button id="scan-domains" class="btn btn-primary">üîç Scan Domains</button>
                    <button id="refresh-domains" class="btn btn-secondary">üîÑ Refresh</button>
                    <span id="domain-scan-status" class="scan-status"></span>
                </div>
            </div>
            
            <div class="section">
                <h2>Domain Health Dashboard</h2>
                <div class="domain-filter">
                    <select id="domain-filter">
                        <option value="all">All Domains</option>
                        <option value="healthy">Healthy</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                        <option value="external">External Backend</option>
                        <option value="docker">Docker Backend</option>
                    </select>
                    <span id="domain-filter-status" class="filter-status"></span>
                </div>
                <div id="domain-cards" class="domain-cards-container">
                    <p>Click "Scan Domains" to analyze routing topology and health status.</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Network Topology Map</h2>
                <div id="network-topology-map" class="topology-map-container">
                    <p>Domain topology will be displayed here after scanning.</p>
                </div>
            </div>
        </div>

        <div id="add-route" class="tab-content">
            <div class="section">
                <h2>Add New Route</h2>
                <form id="route-form" class="form">
                    <div class="form-group">
                        <label for="route-name">Route Name:</label>
                        <input type="text" id="route-name" required placeholder="e.g., my-app">
                    </div>
                    
                    <div class="form-group">
                        <label for="hostname">Hostname:</label>
                        <input type="text" id="hostname" required placeholder="e.g., app.example.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="backend-url">Backend URL:</label>
                        <input type="text" id="backend-url" required placeholder="e.g., http://192.168.1.100:8080">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enable-tls"> Enable TLS/HTTPS
                        </label>
                    </div>
                    
                    <div id="tls-options" class="form-group hidden">
                        <label for="tls-method">TLS Method:</label>
                        <select id="tls-method">
                            <option value="letsencrypt-http">Let's Encrypt (HTTP Challenge)</option>
                            <option value="letsencrypt-dns">Let's Encrypt (DNS Challenge)</option>
                            <option value="letsencrypt-staging-http">Let's Encrypt Staging (HTTP Challenge)</option>
                            <option value="letsencrypt-staging-dns">Let's Encrypt Staging (DNS Challenge)</option>
                            <option value="custom">Custom Certificate</option>
                        </select>
                    </div>
                    
                    <div id="dns-provider-options" class="form-group hidden">
                        <label for="dns-provider">DNS Provider:</label>
                        <select id="dns-provider">
                            <option value="">Select DNS Provider...</option>
                            <!-- Populated dynamically from saved providers -->
                        </select>
                        <div class="dns-provider-help">
                            <small>üí° <a href="#" onclick="switchTab('dns-providers')">Manage DNS Providers</a> to add RFC2136/TSIG configurations</small>
                        </div>
                    </div>
                    
                    <div id="custom-cert-options" class="form-group hidden">
                        <div class="cert-instructions">
                            <h4>Custom Certificate Requirements</h4>
                            <p><strong>Certificate Chain Order:</strong></p>
                            <ol>
                                <li><strong>Server Certificate</strong> (your domain certificate)</li>
                                <li><strong>Intermediate Certificate(s)</strong> (if any, from your CA)</li>
                                <li><strong>Root Certificate</strong> (optional, usually not needed)</li>
                            </ol>
                            <p><strong>Format:</strong> PEM format (Base64 encoded, wrapped in -----BEGIN/END----- lines)</p>
                            <p><strong>Note:</strong> Paste certificates one after another without blank lines between them.</p>
                        </div>
                        
                        <label for="cert-chain">Certificate Chain:</label>
                        <textarea id="cert-chain" rows="15" placeholder="-----BEGIN CERTIFICATE-----
MIIFXzCCBEegAwIBAgIQB...
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIGFTCCBP2gAwIBAgIQD...
-----END CERTIFICATE-----"></textarea>
                        
                        <label for="private-key">Private Key:</label>
                        <textarea id="private-key" rows="10" placeholder="-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC...
-----END PRIVATE KEY-----"></textarea>
                        
                        <div class="cert-validation">
                            <small>‚ö†Ô∏è Ensure your private key matches the certificate and is not password protected.</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ignore-tls-errors"> Ignore Backend TLS Errors
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enable-crowdsec"> Enable CrowdSec Protection
                        </label>
                    </div>
                    
                    <div id="middleware-options" class="form-group hidden">
                        <label for="middleware-select">Available Middleware:</label>
                        <select id="middleware-select" multiple>
                            <!-- Populated dynamically -->
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple middleware</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Add Route</button>
                </form>
            </div>
        </div>

        <div id="middleware" class="tab-content">
            <div class="section">
                <h2>Current Middleware</h2>
                <div id="middleware-list" class="middleware-container">
                    <p>Loading...</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Add CrowdSec Middleware</h2>
                <form id="crowdsec-form" class="form">
                    <div class="form-group">
                        <label for="middleware-name">Middleware Name:</label>
                        <input type="text" id="middleware-name" required placeholder="e.g., crowdsec-bouncer">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="middleware-enabled" checked> Enable CrowdSec Protection
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="crowdsec-mode">CrowdSec Mode:</label>
                        <select id="crowdsec-mode">
                            <option value="stream">Stream (Recommended)</option>
                            <option value="live">Live</option>
                            <option value="alone">Alone</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="lapi-url">Local API URL:</label>
                        <input type="text" id="lapi-url" placeholder="http://crowdsec:8080" value="http://crowdsec:8080">
                    </div>
                    
                    <div class="form-group">
                        <label for="lapi-key">Local API Key:</label>
                        <input type="text" id="lapi-key" required placeholder="Your CrowdSec LAPI key">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="appsec-enabled"> Enable AppSec (WAF)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="trusted-ips">Trusted IPs (comma-separated):</label>
                        <input type="text" id="trusted-ips" placeholder="10.0.0.0/8, 192.168.0.0/16">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Add CrowdSec Middleware</button>
                </form>
            </div>
        </div>

        <div id="dns-providers" class="tab-content">
            <div class="section">
                <h2>DNS Providers</h2>
                <div id="dns-providers-list" class="dns-providers-container">
                    <p>Loading DNS providers...</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Add DNS Provider</h2>
                <form id="dns-provider-form" class="form">
                    <div class="form-group">
                        <label for="provider-name">Provider Name:</label>
                        <input type="text" id="provider-name" required placeholder="e.g., primary-dns, staging-dns">
                        <small>A friendly name to identify this DNS provider configuration</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="provider-type">Provider Type:</label>
                        <select id="provider-type">
                            <option value="rfc2136">RFC2136 (Dynamic DNS Updates)</option>
                        </select>
                        <small>Currently supports RFC2136 for BIND, PowerDNS, Windows DNS, etc.</small>
                    </div>
                    
                    <div id="rfc2136-config" class="provider-config">
                        <div class="form-group">
                            <label for="nameserver">DNS Server:</label>
                            <input type="text" id="nameserver" required placeholder="ns1.example.com:53 or 192.168.1.10:53">
                            <small>DNS server hostname/IP and port that accepts dynamic updates</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="tsig-key">TSIG Key Name:</label>
                            <input type="text" id="tsig-key" required placeholder="traefik-key">
                            <small>The name of your TSIG key configured on the DNS server</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="tsig-secret">TSIG Secret:</label>
                            <input type="password" id="tsig-secret" required placeholder="base64-encoded-secret">
                            <small>Base64 encoded shared secret for TSIG authentication</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="tsig-algorithm">TSIG Algorithm:</label>
                            <select id="tsig-algorithm">
                                <option value="hmac-sha256">HMAC-SHA256 (Recommended)</option>
                                <option value="hmac-sha512">HMAC-SHA512</option>
                                <option value="hmac-sha384">HMAC-SHA384</option>
                                <option value="hmac-sha224">HMAC-SHA224</option>
                                <option value="hmac-sha1">HMAC-SHA1</option>
                                <option value="hmac-md5">HMAC-MD5</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="dns-timeout">DNS Timeout:</label>
                            <input type="text" id="dns-timeout" value="60s" placeholder="60s">
                            <small>Timeout for DNS operations</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="propagation-timeout">Propagation Timeout:</label>
                            <input type="text" id="propagation-timeout" value="120s" placeholder="120s">
                            <small>Time to wait for DNS changes to propagate</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="polling-interval">Polling Interval:</label>
                            <input type="text" id="polling-interval" value="16s" placeholder="16s">
                            <small>How often to check if DNS challenge is complete</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="dns-ttl">DNS TTL:</label>
                            <input type="number" id="dns-ttl" value="120" placeholder="120">
                            <small>TTL for DNS challenge records</small>
                        </div>
                    </div>
                    
                    <div class="dns-provider-examples">
                        <h4>Configuration Examples:</h4>
                        <div class="example-grid">
                            <div class="example-card">
                                <h5>BIND9</h5>
                                <p><strong>Server:</strong> 192.168.1.10:53<br>
                                <strong>Key:</strong> traefik-key<br>
                                <strong>Algorithm:</strong> hmac-sha256</p>
                            </div>
                            <div class="example-card">
                                <h5>PowerDNS</h5>
                                <p><strong>Server:</strong> powerdns.local:53<br>
                                <strong>Key:</strong> powerdns-key<br>
                                <strong>Algorithm:</strong> hmac-sha256</p>
                            </div>
                            <div class="example-card">
                                <h5>Windows DNS</h5>
                                <p><strong>Server:</strong> dc1.domain.local:53<br>
                                <strong>Key:</strong> dhcp-dns-key<br>
                                <strong>Algorithm:</strong> hmac-md5</p>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Add DNS Provider</button>
                </form>
            </div>
        </div>

        <div id="observability" class="tab-content">
            <div class="section">
                <h2>Observability Configuration</h2>
                <p>Configure Traefik's logging, metrics, and tracing capabilities for comprehensive monitoring and observability.</p>
                
                <div class="observability-presets">
                    <h3>üöÄ Quick Configuration Presets</h3>
                    <div class="preset-buttons">
                        <button id="apply-production-preset" class="btn btn-primary">üè≠ Production</button>
                        <button id="apply-development-preset" class="btn btn-secondary">üîß Development</button>
                        <button id="apply-minimal-preset" class="btn btn-secondary">üì¶ Minimal</button>
                        <button id="apply-custom-preset" class="btn btn-secondary">‚öôÔ∏è Custom</button>
                    </div>
                    <div class="preset-descriptions">
                        <div class="preset-desc" data-preset="production">
                            <strong>Production:</strong> JSON logs + full metrics + Jaeger tracing (10% sampling)
                        </div>
                        <div class="preset-desc" data-preset="development">
                            <strong>Development:</strong> CLF logs + basic metrics + no tracing
                        </div>
                        <div class="preset-desc" data-preset="minimal">
                            <strong>Minimal:</strong> All observability disabled for minimal overhead
                        </div>
                        <div class="preset-desc" data-preset="custom">
                            <strong>Custom:</strong> Manual configuration using the forms below
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>üìä Access Logs</h2>
                <form id="access-logs-form" class="form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enable-access-logs"> Enable Access Logging
                        </label>
                        <small>Enable detailed request logging for monitoring and analysis</small>
                    </div>
                    
                    <div id="access-logs-options" class="conditional-section hidden">
                        <div class="form-group">
                            <label for="log-format">Log Format:</label>
                            <select id="log-format">
                                <option value="json">JSON (recommended for log aggregation)</option>
                                <option value="clf">Common Log Format (CLF)</option>
                                <option value="custom">Custom Format</option>
                            </select>
                            <small>Choose format based on your log processing requirements</small>
                        </div>
                        
                        <div id="custom-format-section" class="hidden">
                            <div class="form-group">
                                <label for="custom-log-format">Custom Log Format:</label>
                                <textarea id="custom-log-format" rows="3" placeholder="Custom format string using Traefik variables"></textarea>
                                <small>Define custom log format using Traefik's log variables</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="log-file-path">Log File Path:</label>
                            <input type="text" id="log-file-path" value="/logs/access.log" placeholder="/logs/access.log">
                            <small>File path for access logs (container path)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>External Log Shipping:</label>
                            <label>
                                <input type="checkbox" id="enable-graylog"> Enable Graylog Integration
                            </label>
                            <small>Send logs to external Graylog server for centralized logging</small>
                        </div>
                        
                        <div id="graylog-options" class="conditional-section hidden">
                            <div class="form-group">
                                <label for="graylog-endpoint">Graylog Endpoint:</label>
                                <input type="text" id="graylog-endpoint" placeholder="graylog.company.com:12201">
                                <small>Graylog GELF UDP endpoint (host:port)</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="graylog-facility">Facility:</label>
                                <input type="text" id="graylog-facility" value="traefik" placeholder="traefik">
                                <small>Facility name for log categorization</small>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Update Access Logs</button>
                    <button type="button" id="test-log-config" class="btn btn-secondary">Test Configuration</button>
                </form>
            </div>
            
            <div class="section">
                <h2>üîç Prometheus Metrics</h2>
                <form id="metrics-form" class="form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enable-metrics"> Enable Prometheus Metrics
                        </label>
                        <small>Expose metrics endpoint for Prometheus scraping</small>
                    </div>
                    
                    <div id="metrics-options" class="conditional-section hidden">
                        <div class="form-group">
                            <label for="metrics-port">Metrics Port:</label>
                            <input type="number" id="metrics-port" value="8082" placeholder="8082">
                            <small>Port for metrics endpoint (usually different from dashboard)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="metrics-path">Metrics Path:</label>
                            <input type="text" id="metrics-path" value="/metrics" placeholder="/metrics">
                            <small>URL path for metrics endpoint</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="metrics-interval">Scrape Interval:</label>
                            <select id="metrics-interval">
                                <option value="10s">10 seconds</option>
                                <option value="30s" selected>30 seconds</option>
                                <option value="1m">1 minute</option>
                                <option value="5m">5 minutes</option>
                            </select>
                            <small>How often Prometheus should scrape metrics</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Metrics Categories:</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="metrics-entrypoint" checked> EntryPoint Metrics</label>
                                <label><input type="checkbox" id="metrics-router" checked> Router Metrics</label>
                                <label><input type="checkbox" id="metrics-service" checked> Service Metrics</label>
                            </div>
                            <small>Select which metric categories to expose</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Update Metrics</button>
                    <button type="button" id="test-metrics-endpoint" class="btn btn-secondary">Test Endpoint</button>
                </form>
                
                <div id="metrics-info" class="info-section hidden">
                    <h3>Prometheus Configuration</h3>
                    <p>Add this job to your Prometheus configuration:</p>
                    <pre id="prometheus-config-example"></pre>
                </div>
            </div>
            
            <div class="section">
                <h2>üìà OpenTelemetry Tracing</h2>
                <form id="tracing-form" class="form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enable-tracing"> Enable Distributed Tracing
                        </label>
                        <small>Enable OpenTelemetry tracing for request flow analysis</small>
                    </div>
                    
                    <div id="tracing-options" class="conditional-section hidden">
                        <div class="form-group">
                            <label for="tracing-backend">Tracing Backend:</label>
                            <select id="tracing-backend">
                                <option value="jaeger">Jaeger</option>
                                <option value="zipkin">Zipkin</option>
                                <option value="otlp">OpenTelemetry Protocol (OTLP)</option>
                            </select>
                            <small>Choose your tracing backend system</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="tracing-endpoint">Tracing Endpoint:</label>
                            <input type="text" id="tracing-endpoint" placeholder="http://jaeger:14268/api/traces">
                            <small>Endpoint URL for sending traces</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="sampling-rate">Sampling Rate:</label>
                            <input type="range" id="sampling-rate" min="0" max="1" step="0.1" value="1.0">
                            <span id="sampling-rate-value">100%</span>
                            <small>Percentage of requests to trace (1.0 = 100%, 0.1 = 10%)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="service-name">Service Name:</label>
                            <input type="text" id="service-name" value="traefik" placeholder="traefik">
                            <small>Service name for trace identification</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="trace-headers">Trace Headers:</label>
                            <textarea id="trace-headers" rows="3" placeholder="X-Trace-Id&#10;X-Span-Id"></textarea>
                            <small>Additional headers to include in traces (one per line)</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Update Tracing</button>
                    <button type="button" id="test-tracing-connection" class="btn btn-secondary">Test Connection</button>
                </form>
            </div>
            
            <div class="section">
                <h2>‚öôÔ∏è Configuration Status</h2>
                <div id="observability-status" class="status-grid">
                    <div class="status-card">
                        <h4>üìä Access Logs</h4>
                        <div id="logs-status" class="status-indicator">Not Configured</div>
                    </div>
                    <div class="status-card">
                        <h4>üîç Metrics</h4>
                        <div id="metrics-status" class="status-indicator">Not Configured</div>
                    </div>
                    <div class="status-card">
                        <h4>üìà Tracing</h4>
                        <div id="tracing-status" class="status-indicator">Not Configured</div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button id="load-observability-config" class="btn btn-secondary">Load Current Config</button>
                    <button id="export-observability-config" class="btn btn-secondary">Export Config</button>
                    <button id="restart-traefik-observability" class="btn btn-warning">Apply & Restart Traefik</button>
                </div>
            </div>
        </div>

        <div id="label-generator" class="tab-content">
            <div class="section">
                <h2>Docker Label Generator</h2>
                <p>Generate Traefik labels for your Docker Compose services. This allows services to self-configure when deployed.</p>
                
                <form id="label-generator-form" class="form">
                    <div class="form-group">
                        <label for="label-service-name">Service Name:</label>
                        <input type="text" id="label-service-name" required placeholder="e.g., my-app, api, frontend">
                        <small>Used for router and service names in Traefik configuration</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="label-hostname">Hostname/Domain:</label>
                        <input type="text" id="label-hostname" required placeholder="e.g., app.example.com, api.mysite.org">
                        <small>The domain name that will route to this service</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="label-port">Service Port:</label>
                        <input type="number" id="label-port" placeholder="3000">
                        <small>Internal container port (optional, Traefik will auto-detect if only one port)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="label-path">Path (optional):</label>
                        <input type="text" id="label-path" placeholder="/api, /app">
                        <small>URL path prefix (leave empty for domain root)</small>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="label-enable-tls"> Enable TLS/HTTPS
                        </label>
                    </div>
                    
                    <div id="label-tls-options" class="form-group hidden">
                        <label for="label-tls-method">TLS Method:</label>
                        <select id="label-tls-method">
                            <option value="letsencrypt-http">Let's Encrypt (HTTP Challenge)</option>
                            <option value="letsencrypt-dns">Let's Encrypt (DNS Challenge)</option>
                            <option value="letsencrypt-staging-http">Let's Encrypt Staging (HTTP Challenge)</option>
                            <option value="letsencrypt-staging-dns">Let's Encrypt Staging (DNS Challenge)</option>
                            <option value="custom">Custom Certificate</option>
                        </select>
                    </div>
                    
                    <div id="label-dns-provider-options" class="form-group hidden">
                        <label for="label-dns-provider">DNS Provider:</label>
                        <select id="label-dns-provider">
                            <option value="">Select DNS Provider...</option>
                            <!-- Populated dynamically from saved providers -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="label-enable-crowdsec"> Enable CrowdSec Protection
                        </label>
                    </div>
                    
                    <div id="label-middleware-options" class="form-group hidden">
                        <label for="label-middleware-select">Additional Middleware:</label>
                        <select id="label-middleware-select" multiple>
                            <!-- Populated dynamically -->
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple middleware</small>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="label-ignore-tls-errors"> Ignore Backend TLS Errors
                        </label>
                        <small>Enable for services with self-signed certificates</small>
                    </div>
                    
                    <button type="button" id="generate-labels" class="btn btn-primary">Generate Labels</button>
                </form>
            </div>
            
            <div id="generated-labels-section" class="section hidden">
                <h2>Generated Docker Labels</h2>
                <div class="label-output-container">
                    <div class="label-output-header">
                        <h3>Add these labels to your docker-compose.yml:</h3>
                        <button id="copy-labels" class="btn btn-secondary">üìã Copy to Clipboard</button>
                    </div>
                    
                    <div class="label-code-container">
                        <pre id="generated-labels-output" class="label-code"></pre>
                    </div>
                    
                    <div class="label-usage-example">
                        <h4>Example docker-compose.yml usage:</h4>
                        <pre class="label-code" id="compose-example"></pre>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Label Templates</h2>
                <div class="label-templates-grid">
                    <div class="label-template-card" data-template="simple-web-app">
                        <h3>Simple Web App</h3>
                        <p>Basic web application with Let's Encrypt SSL</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                    <div class="label-template-card" data-template="api-service">
                        <h3>API Service</h3>
                        <p>REST API with path routing and CORS</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                    <div class="label-template-card" data-template="protected-service">
                        <h3>Protected Service</h3>
                        <p>Service with CrowdSec protection enabled</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                    <div class="label-template-card" data-template="development-service">
                        <h3>Development Service</h3>
                        <p>Local development with HTTP and TLS bypass</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="service-discovery" class="tab-content">
            <div class="section">
                <h2>Docker Service Discovery</h2>
                <p>Discover and manage services that have Traefik labels in their Docker containers.</p>
                
                <div class="service-discovery-controls">
                    <button id="scan-services" class="btn btn-primary">üîç Scan for Services</button>
                    <button id="refresh-services" class="btn btn-secondary">üîÑ Refresh</button>
                    <span id="scan-status" class="scan-status"></span>
                </div>
            </div>
            
            <div class="section">
                <h2>Discovered Services</h2>
                <div class="service-filter">
                    <select id="service-filter">
                        <option value="all">All Services</option>
                        <option value="running">Running Only</option>
                        <option value="stopped">Stopped Only</option>
                        <option value="traefik-enabled">Traefik Enabled</option>
                        <option value="traefik-disabled">Traefik Disabled</option>
                    </select>
                    <span id="service-filter-status" class="filter-status"></span>
                </div>
                <div id="discovered-services" class="discovered-services-container">
                    <p>Click "Scan for Services" to discover Docker containers with Traefik labels.</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Docker Networks</h2>
                <div id="docker-networks" class="networks-container">
                    <p>Loading network information...</p>
                </div>
            </div>
            
            <div id="service-edit-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Service Labels</h3>
                        <button class="modal-close" id="close-service-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="service-edit-form">
                            <input type="hidden" id="edit-container-id">
                            <div class="form-group">
                                <label for="edit-service-name">Service Name:</label>
                                <input type="text" id="edit-service-name" readonly>
                            </div>
                            <div class="form-group">
                                <label for="edit-traefik-enabled">Traefik Enabled:</label>
                                <select id="edit-traefik-enabled">
                                    <option value="true">Enabled</option>
                                    <option value="false">Disabled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit-router-rule">Router Rule:</label>
                                <input type="text" id="edit-router-rule" placeholder="Host(`example.com`)">
                            </div>
                            <div class="form-group">
                                <label for="edit-entrypoints">Entrypoints:</label>
                                <input type="text" id="edit-entrypoints" placeholder="web,websecure">
                            </div>
                            <div class="form-group">
                                <label for="edit-service-port">Service Port:</label>
                                <input type="number" id="edit-service-port" placeholder="80">
                            </div>
                            <div class="form-group">
                                <label for="edit-middlewares">Middlewares:</label>
                                <input type="text" id="edit-middlewares" placeholder="middleware1,middleware2">
                            </div>
                            <div class="modal-actions">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                <button type="button" class="btn btn-secondary" id="cancel-edit">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="network-management" class="tab-content">
            <div class="section">
                <h2>Traefik Network Connections</h2>
                <div class="network-management-controls">
                    <button id="scan-networks" class="btn btn-primary">üîç Scan Networks</button>
                    <button id="refresh-networks" class="btn btn-secondary">üîÑ Refresh</button>
                    <span id="network-scan-status" class="scan-status"></span>
                </div>
                
                <div id="traefik-networks" class="traefik-networks-container">
                    <p>Click "Scan Networks" to discover available Docker networks.</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Available Networks</h2>
                <div class="network-filter">
                    <select id="network-filter">
                        <option value="all">All Networks</option>
                        <option value="connected">Connected to Traefik</option>
                        <option value="disconnected">Not Connected</option>
                        <option value="external">External Networks</option>
                    </select>
                </div>
                <div id="available-networks" class="available-networks-container">
                    <p>Loading network information...</p>
                </div>
            </div>
            
            <div class="section">
                <h2>Network Topology</h2>
                <div id="network-topology" class="network-topology-container">
                    <p>Network topology visualization will appear here after scanning.</p>
                </div>
            </div>
            
            <div id="network-connect-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Connect to Network</h3>
                        <button class="modal-close" id="close-network-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="network-connect-form">
                            <input type="hidden" id="connect-network-id">
                            <div class="form-group">
                                <label for="connect-network-name">Network:</label>
                                <input type="text" id="connect-network-name" readonly>
                            </div>
                            <div class="form-group">
                                <label for="connect-alias">Alias (optional):</label>
                                <input type="text" id="connect-alias" placeholder="Custom network alias for Traefik">
                                <small>Optional alias for Traefik in this network</small>
                            </div>
                            <div class="form-group">
                                <label for="connect-ip">IP Address (optional):</label>
                                <input type="text" id="connect-ip" placeholder="e.g., 172.20.0.100">
                                <small>Leave blank for automatic IP assignment</small>
                            </div>
                            <div class="modal-actions">
                                <button type="submit" class="btn btn-primary">Connect</button>
                                <button type="button" class="btn btn-secondary" id="cancel-network-connect">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="templates" class="tab-content">
            <div class="section">
                <h2>Quick Templates</h2>
                <div class="templates-grid">
                    <div class="template-card" data-template="simple-http">
                        <h3>Simple HTTP Service</h3>
                        <p>Basic HTTP service without TLS</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                    <div class="template-card" data-template="https-letsencrypt">
                        <h3>HTTPS with Let's Encrypt</h3>
                        <p>Production certificates via DNS challenge</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                    <div class="template-card" data-template="https-staging">
                        <h3>HTTPS Staging</h3>
                        <p>Test certificates via DNS challenge</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                    <div class="template-card" data-template="internal-service">
                        <h3>Internal Service</h3>
                        <p>Internal service that ignores TLS errors</p>
                        <button class="btn btn-secondary">Use Template</button>
                    </div>
                    
                </div>
            </div>
        </div>

        <div id="system-config" class="tab-content">
            <div class="section">
                <h2>System Configuration Management</h2>
                <p>Manage, backup, and restore your complete Traefik UI configuration. All DNS providers, observability settings, UI preferences, and templates are stored in a unified configuration file.</p>
                
                <div class="config-status-grid">
                    <div class="config-status-card">
                        <h4>üìÅ Configuration File</h4>
                        <div id="config-file-status" class="status-indicator">Loading...</div>
                        <small id="config-file-path">/config/ui-config.yml</small>
                    </div>
                    <div class="config-status-card">
                        <h4>üóÉÔ∏è Backups Available</h4>
                        <div id="backup-count-status" class="status-indicator">Loading...</div>
                        <small>Automatic & manual backups</small>
                    </div>
                    <div class="config-status-card">
                        <h4>‚úÖ Validation Status</h4>
                        <div id="validation-status" class="status-indicator">Valid</div>
                        <small>Configuration integrity</small>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>üìÑ Configuration Viewer</h2>
                <div class="config-viewer-controls">
                    <button id="load-config-viewer" class="btn btn-primary">üìñ Load Configuration</button>
                    <button id="refresh-config-viewer" class="btn btn-secondary">üîÑ Refresh</button>
                    <button id="validate-current-config" class="btn btn-secondary">‚úÖ Validate</button>
                    <button id="toggle-config-editor" class="btn btn-secondary">‚úèÔ∏è Edit Mode</button>
                </div>
                
                <div id="config-viewer" class="config-viewer-container">
                    <div class="config-placeholder">
                        <p>Click "Load Configuration" to view the current system configuration.</p>
                    </div>
                </div>
                
                <div id="config-editor-section" class="config-editor-section hidden">
                    <div class="editor-controls">
                        <button id="save-config-changes" class="btn btn-primary">üíæ Save Changes</button>
                        <button id="cancel-config-edit" class="btn btn-secondary">‚ùå Cancel</button>
                        <button id="validate-config-edit" class="btn btn-secondary">üß™ Validate</button>
                        <span id="config-edit-status" class="edit-status"></span>
                    </div>
                    <textarea id="config-editor" rows="20" placeholder="YAML configuration will appear here..."></textarea>
                    
                    <div id="validation-results" class="validation-results hidden">
                        <h4>Validation Results</h4>
                        <div id="validation-errors" class="validation-errors"></div>
                        <div id="validation-warnings" class="validation-warnings"></div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>üì¶ Export & Import</h2>
                <div class="export-import-grid">
                    <div class="export-section">
                        <h3>üì§ Export Configuration</h3>
                        <p>Download your complete configuration as a YAML file for backup or migration.</p>
                        <button id="export-config" class="btn btn-primary">üì• Download Configuration</button>
                        <div class="export-options">
                            <label>
                                <input type="checkbox" id="include-sensitive" checked> Include sensitive data (TSIG secrets, etc.)
                            </label>
                        </div>
                    </div>
                    
                    <div class="import-section">
                        <h3>üì§ Import Configuration</h3>
                        <p>Upload and apply a configuration file. Changes will be validated before application.</p>
                        <input type="file" id="config-file-input" accept=".yml,.yaml" style="display: none;">
                        <button id="select-config-file" class="btn btn-secondary">üìÅ Select File</button>
                        <button id="validate-import" class="btn btn-secondary hidden">üß™ Validate Only</button>
                        <button id="apply-import" class="btn btn-primary hidden">‚úÖ Apply Configuration</button>
                        
                        <div id="import-preview" class="import-preview hidden">
                            <h4>Import Preview</h4>
                            <div id="import-validation-results"></div>
                            <div class="import-file-info">
                                <span id="import-filename"></span>
                                <span id="import-filesize"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>üóÑÔ∏è Backup & Restore</h2>
                <div class="backup-restore-controls">
                    <button id="create-manual-backup" class="btn btn-primary">üíæ Create Backup</button>
                    <button id="refresh-backup-list" class="btn btn-secondary">üîÑ Refresh List</button>
                    <button id="download-all-backups" class="btn btn-secondary">üì¶ Download All</button>
                    <button id="cleanup-old-backups" class="btn btn-warning">üßπ Cleanup Old Backups</button>
                </div>
                
                <div id="manual-backup-section" class="manual-backup-section hidden">
                    <div class="form-group">
                        <label for="backup-name">Backup Name (optional):</label>
                        <input type="text" id="backup-name" placeholder="e.g., pre-migration, stable-config">
                        <small>Leave empty for automatic timestamp naming</small>
                    </div>
                    <div class="backup-form-actions">
                        <button id="confirm-create-backup" class="btn btn-primary">‚úÖ Create Backup</button>
                        <button id="cancel-create-backup" class="btn btn-secondary">‚ùå Cancel</button>
                    </div>
                </div>
                
                <div class="backup-history">
                    <h3>Backup History</h3>
                    <div id="backup-list" class="backup-list-container">
                        <p>Loading backup history...</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>‚öôÔ∏è System Settings</h2>
                <form id="system-settings-form" class="form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="auto-backup-enabled" checked> Enable Automatic Backups
                        </label>
                        <small>Create backups before major configuration changes</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="backup-retention-days">Backup Retention (days):</label>
                        <input type="number" id="backup-retention-days" value="30" min="1" max="365">
                        <small>Automatically delete backups older than this many days</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="config-validation-level">Validation Level:</label>
                        <select id="config-validation-level">
                            <option value="strict">Strict (reject any warnings)</option>
                            <option value="normal" selected>Normal (allow warnings)</option>
                            <option value="permissive">Permissive (minimal validation)</option>
                        </select>
                        <small>How strictly to validate configuration changes</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">üíæ Save Settings</button>
                </form>
            </div>
            
            <div id="restore-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Restore Configuration</h3>
                        <button class="modal-close" id="close-restore-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="restore-warning">
                            <h4>‚ö†Ô∏è Warning</h4>
                            <p>This will replace your current configuration with the selected backup. Your current configuration will be automatically backed up before restoration.</p>
                        </div>
                        
                        <div class="restore-info">
                            <div class="restore-detail">
                                <strong>Backup:</strong> <span id="restore-filename"></span>
                            </div>
                            <div class="restore-detail">
                                <strong>Created:</strong> <span id="restore-created"></span>
                            </div>
                            <div class="restore-detail">
                                <strong>Version:</strong> <span id="restore-version"></span>
                            </div>
                            <div class="restore-detail">
                                <strong>Type:</strong> <span id="restore-type"></span>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button id="confirm-restore" class="btn btn-warning">‚ö†Ô∏è Restore Configuration</button>
                            <button id="cancel-restore" class="btn btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button id="restart-traefik" class="btn btn-warning">Restart Traefik</button>
        </div>
    </div>

    <div id="notification" class="notification hidden"></div>
    
    <script src="script.js"></script>
</body>
</html>